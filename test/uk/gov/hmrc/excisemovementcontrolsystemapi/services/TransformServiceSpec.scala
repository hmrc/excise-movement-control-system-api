/*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package uk.gov.hmrc.excisemovementcontrolsystemapi.services

import org.apache.pekko.Done
import org.mockito.ArgumentMatchersSugar.{any, eqTo}
import org.mockito.MockitoSugar.{reset, verify, verifyZeroInteractions, when}
import org.scalatest.concurrent.ScalaFutures
import org.scalatest.{BeforeAndAfterEach, EitherValues}
import org.scalatestplus.mockito.MockitoSugar.mock
import org.scalatestplus.play.PlaySpec
import play.api.libs.json.Json
import play.api.mvc.Results.{BadRequest, InternalServerError}
import play.api.test.Helpers.{await, defaultAwaitTimeout}
import uk.gov.hmrc.excisemovementcontrolsystemapi.config.AppConfig
import uk.gov.hmrc.excisemovementcontrolsystemapi.connectors.PushNotificationConnector
import uk.gov.hmrc.excisemovementcontrolsystemapi.models.notification.Notification
import uk.gov.hmrc.excisemovementcontrolsystemapi.models.notification.NotificationResponse._
import uk.gov.hmrc.excisemovementcontrolsystemapi.utils.DateTimeService
import uk.gov.hmrc.http.HeaderCarrier

import java.time.Instant
import scala.Right
import scala.concurrent.{ExecutionContext, Future}

class TransformServiceSpec extends PlaySpec with EitherValues with BeforeAndAfterEach with ScalaFutures {

  implicit private val hc: HeaderCarrier = HeaderCarrier()
  implicit private val ex: ExecutionContext = ExecutionContext.global

  private val appConfig = mock[AppConfig]
  private val timestamp = Instant.parse("2024-10-01T12:32:32.12345678Z")
  private val sut = new TransformService()


  "transformation" should {


    "return no errors" in {
      val messageType = "IE801"

      val encodedMessage = "PGllODAxOklFODAxIHhtbG5zPSJodHRwOi8vd3d3LmdvdnRhbGsuZ292LnVrL3RheGF0aW9uL0ludGVybmF0aW9uYWxUcmFkZS9FeGNpc2UvTW92ZW1lbnRGb3JUcmFkZXJEYXRhLzMiIHhtbG5zOmRvYz0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpkb2M6VjMuMTMiIHhtbG5zOmVtY3M9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6RU1DUzpWMy4xMyIgeG1sbnM6ZXVjPSJodHRwOi8vd3d3LmdvdnRhbGsuZ292LnVrL3RheGF0aW9uL0ludGVybmF0aW9uYWxUcmFkZS9FeGNpc2UvRW1jc1VrQ29kZXMvMyIgeG1sbnM6aWUwPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODgwOlYzLjEzIiB4bWxuczppZTE9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MjU6VjMuMTMiIHhtbG5zOmllMj0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTcxNzpWMy4xMyIgeG1sbnM6aWUzPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODE1OlYzLjEzIiB4bWxuczppZT0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTkzNDpWMy4xMyIgeG1sbnM6aWU3MDR1az0iaHR0cDovL3d3dy5nb3Z0YWxrLmdvdi51ay90YXhhdGlvbi9JbnRlcm5hdGlvbmFsVHJhZGUvRXhjaXNlL2llNzA0dWsvMyIgeG1sbnM6aWU4MDE9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MDE6VjMuMTMiIHhtbG5zOmllODAyPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODAyOlYzLjEzIiB4bWxuczppZTgwMz0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTgwMzpWMy4xMyIgeG1sbnM6aWU4MDc9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MDc6VjMuMTMiIHhtbG5zOmllODEwPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODEwOlYzLjEzIiB4bWxuczppZTgxMz0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTgxMzpWMy4xMyIgeG1sbnM6aWU4MTg9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MTg6VjMuMTMiIHhtbG5zOmllODE5PSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODE5OlYzLjEzIiB4bWxuczppZTgyOT0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTgyOTpWMy4xMyIgeG1sbnM6aWU4Mzc9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4Mzc6VjMuMTMiIHhtbG5zOmllODM5PSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODM5OlYzLjEzIiB4bWxuczppZTg0MD0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTg0MDpWMy4xMyIgeG1sbnM6aWU4NzE9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4NzE6VjMuMTMiIHhtbG5zOmllODgxPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODgxOlYzLjEzIiB4bWxuczppZTkwNT0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTkwNTpWMy4xMyIgeG1sbnM6dGNsPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OlRDTDpWMy4xMyIgeG1sbnM6dG1zPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OlRNUzpWMy4xMyIgeG1sbnM6dG5zND0iaHR0cDovL3d3dy5nb3Z0YWxrLmdvdi51ay90YXhhdGlvbi9JbnRlcm5hdGlvbmFsVHJhZGUvQ29tbW9uL0NvbnRyb2xEb2N1bWVudCIgeG1sbnM6dG5zNT0iaHR0cDovL3d3dy5nb3Z0YWxrLmdvdi51ay90YXhhdGlvbi9JbnRlcm5hdGlvbmFsVHJhZGUvRXhjaXNlL01vdmVtZW50Rm9yVHJhZGVyRGF0YS8zIiB4bWxuczp0bnM9Imh0dHA6Ly93d3cuZ292dGFsay5nb3YudWsvdGF4YXRpb24vSW50ZXJuYXRpb25hbFRyYWRlL0V4Y2lzZS9OZXdNZXNzYWdlc0RhdGEvMyIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIj48aWU4MDE6SGVhZGVyPjx0bXM6TWVzc2FnZVNlbmRlcj5OREVBLlhJPC90bXM6TWVzc2FnZVNlbmRlcj48dG1zOk1lc3NhZ2VSZWNpcGllbnQ+TkRFQS5BVDwvdG1zOk1lc3NhZ2VSZWNpcGllbnQ+PHRtczpEYXRlT2ZQcmVwYXJhdGlvbj4yMDIzLTA2LTIyPC90bXM6RGF0ZU9mUHJlcGFyYXRpb24+PHRtczpUaW1lT2ZQcmVwYXJhdGlvbj4xMjozNzowOC43NTU8L3RtczpUaW1lT2ZQcmVwYXJhdGlvbj48dG1zOk1lc3NhZ2VJZGVudGlmaWVyPlhJMDAwMDAzPC90bXM6TWVzc2FnZUlkZW50aWZpZXI+PHRtczpDb3JyZWxhdGlvbklkZW50aWZpZXI+UE9SVEFMNmRlMWI4MjI1NjJjNDNmYjkyMjBkMjM2ZTQ4N2M5MjA8L3RtczpDb3JyZWxhdGlvbklkZW50aWZpZXI+PC9pZTgwMTpIZWFkZXI+PGllODAxOkJvZHk+PGllODAxOkVBREVTQURDb250YWluZXI+PGllODAxOkNvbnNpZ25lZVRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpUcmFkZXJpZD5HQldLUU9aODBWTFlSPC9pZTgwMTpUcmFkZXJpZD48aWU4MDE6VHJhZGVyTmFtZT5BRk9SIEtBTEUgTFREPC9pZTgwMTpUcmFkZXJOYW1lPjxpZTgwMTpTdHJlZXROYW1lPlRoZSBTdHJlZXQ8L2llODAxOlN0cmVldE5hbWU+PGllODAxOlBvc3Rjb2RlPkFUMTIzPC9pZTgwMTpQb3N0Y29kZT48aWU4MDE6Q2l0eT5UaGUgQ2l0eTwvaWU4MDE6Q2l0eT48L2llODAxOkNvbnNpZ25lZVRyYWRlcj48aWU4MDE6RXhjaXNlTW92ZW1lbnQ+PGllODAxOkFkbWluaXN0cmF0aXZlUmVmZXJlbmNlQ29kZT4yM1hJMDAwMDAwMDAwMDAwMDAwMjE8L2llODAxOkFkbWluaXN0cmF0aXZlUmVmZXJlbmNlQ29kZT48aWU4MDE6RGF0ZUFuZFRpbWVPZlZhbGlkYXRpb25PZkVhZEVzYWQ+MjAyMy0wNi0yMlQxMTozNzoxMC4zNDU3MzkzOTY8L2llODAxOkRhdGVBbmRUaW1lT2ZWYWxpZGF0aW9uT2ZFYWRFc2FkPjwvaWU4MDE6RXhjaXNlTW92ZW1lbnQ+PGllODAxOkNvbnNpZ25vclRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpUcmFkZXJFeGNpc2VOdW1iZXI+R0JXS1FPWjk5VkxZUjwvaWU4MDE6VHJhZGVyRXhjaXNlTnVtYmVyPjxpZTgwMTpUcmFkZXJOYW1lPkNsYXJreXMgRWFnbGVzPC9pZTgwMTpUcmFkZXJOYW1lPjxpZTgwMTpTdHJlZXROYW1lPkhhcHB5IFN0cmVldDwvaWU4MDE6U3RyZWV0TmFtZT48aWU4MDE6UG9zdGNvZGU+QlQxIDFCRzwvaWU4MDE6UG9zdGNvZGU+PGllODAxOkNpdHk+VGhlIENpdHk8L2llODAxOkNpdHk+PC9pZTgwMTpDb25zaWdub3JUcmFkZXI+PGllODAxOlBsYWNlT2ZEaXNwYXRjaFRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpSZWZlcmVuY2VPZlRheFdhcmVob3VzZT5YSTAwMDAwNDY3MDE0PC9pZTgwMTpSZWZlcmVuY2VPZlRheFdhcmVob3VzZT48L2llODAxOlBsYWNlT2ZEaXNwYXRjaFRyYWRlcj48aWU4MDE6RGVsaXZlcnlQbGFjZVRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpUcmFkZXJpZD5HQjAwMDAwNjAyMDc4PC9pZTgwMTpUcmFkZXJpZD48aWU4MDE6VHJhZGVyTmFtZT5NRVRFU1QgQk9ORCBTVFRTVEdFPC9pZTgwMTpUcmFkZXJOYW1lPjxpZTgwMTpTdHJlZXROYW1lPldISVRFVEVTVCBST0FEIE1FVEVTVCBDSVRZIEVTVEFURTwvaWU4MDE6U3RyZWV0TmFtZT48aWU4MDE6UG9zdGNvZGU+Qk4yIDRLWDwvaWU4MDE6UG9zdGNvZGU+PGllODAxOkNpdHk+U1RURVNULEtFTlQ8L2llODAxOkNpdHk+PC9pZTgwMTpEZWxpdmVyeVBsYWNlVHJhZGVyPjxpZTgwMTpDb21wZXRlbnRBdXRob3JpdHlEaXNwYXRjaE9mZmljZT48aWU4MDE6UmVmZXJlbmNlTnVtYmVyPkdCMDA0MDk4PC9pZTgwMTpSZWZlcmVuY2VOdW1iZXI+PC9pZTgwMTpDb21wZXRlbnRBdXRob3JpdHlEaXNwYXRjaE9mZmljZT48aWU4MDE6RWFkRXNhZD48aWU4MDE6TG9jYWxSZWZlcmVuY2VOdW1iZXI+bHJuaWU4MTU0OTY4NTcxPC9pZTgwMTpMb2NhbFJlZmVyZW5jZU51bWJlcj48aWU4MDE6SW52b2ljZU51bWJlcj5JTlZPSUNFMDAxPC9pZTgwMTpJbnZvaWNlTnVtYmVyPjxpZTgwMTpJbnZvaWNlRGF0ZT4yMDE4LTA0LTA0PC9pZTgwMTpJbnZvaWNlRGF0ZT48aWU4MDE6T3JpZ2luVHlwZUNvZGU+MTwvaWU4MDE6T3JpZ2luVHlwZUNvZGU+PGllODAxOkRhdGVPZkRpc3BhdGNoPjIwMjEtMTItMDI8L2llODAxOkRhdGVPZkRpc3BhdGNoPjxpZTgwMTpUaW1lT2ZEaXNwYXRjaD4yMjozNzowMDwvaWU4MDE6VGltZU9mRGlzcGF0Y2g+PC9pZTgwMTpFYWRFc2FkPjxpZTgwMTpIZWFkZXJFYWRFc2FkPjxpZTgwMTpTZXF1ZW5jZU51bWJlcj4xPC9pZTgwMTpTZXF1ZW5jZU51bWJlcj48aWU4MDE6RGF0ZUFuZFRpbWVPZlVwZGF0ZVZhbGlkYXRpb24+MjAyMy0wNi0yMlQxMTozNzoxMC4zNDU4MDEwMjk8L2llODAxOkRhdGVBbmRUaW1lT2ZVcGRhdGVWYWxpZGF0aW9uPjxpZTgwMTpEZXN0aW5hdGlvblR5cGVDb2RlPjE8L2llODAxOkRlc3RpbmF0aW9uVHlwZUNvZGU+PGllODAxOkpvdXJuZXlUaW1lPkQwMTwvaWU4MDE6Sm91cm5leVRpbWU+PGllODAxOlRyYW5zcG9ydEFycmFuZ2VtZW50PjE8L2llODAxOlRyYW5zcG9ydEFycmFuZ2VtZW50PjwvaWU4MDE6SGVhZGVyRWFkRXNhZD48aWU4MDE6VHJhbnNwb3J0TW9kZT48aWU4MDE6VHJhbnNwb3J0TW9kZUNvZGU+MTwvaWU4MDE6VHJhbnNwb3J0TW9kZUNvZGU+PC9pZTgwMTpUcmFuc3BvcnRNb2RlPjxpZTgwMTpNb3ZlbWVudEd1YXJhbnRlZT48aWU4MDE6R3VhcmFudG9yVHlwZUNvZGU+MTwvaWU4MDE6R3VhcmFudG9yVHlwZUNvZGU+PC9pZTgwMTpNb3ZlbWVudEd1YXJhbnRlZT48aWU4MDE6Qm9keUVhZEVzYWQ+PGllODAxOkJvZHlSZWNvcmRVbmlxdWVSZWZlcmVuY2U+MTwvaWU4MDE6Qm9keVJlY29yZFVuaXF1ZVJlZmVyZW5jZT48aWU4MDE6RXhjaXNlUHJvZHVjdENvZGU+RTQxMDwvaWU4MDE6RXhjaXNlUHJvZHVjdENvZGU+PGllODAxOkNuQ29kZT4yNzEwMTIzMTwvaWU4MDE6Q25Db2RlPjxpZTgwMTpRdWFudGl0eT4xMDAuMDAwPC9pZTgwMTpRdWFudGl0eT48aWU4MDE6R3Jvc3NNYXNzPjEwMC4wMDwvaWU4MDE6R3Jvc3NNYXNzPjxpZTgwMTpOZXRNYXNzPjkwLjAwPC9pZTgwMTpOZXRNYXNzPjxpZTgwMTpEZW5zaXR5PjEwLjAwPC9pZTgwMTpEZW5zaXR5PjxpZTgwMTpQYWNrYWdlPjxpZTgwMTpLaW5kT2ZQYWNrYWdlcz5CSDwvaWU4MDE6S2luZE9mUGFja2FnZXM+PGllODAxOk51bWJlck9mUGFja2FnZXM+MjwvaWU4MDE6TnVtYmVyT2ZQYWNrYWdlcz48aWU4MDE6U2hpcHBpbmdNYXJrcz5TaGlwcGluZyBjb21tZW50PC9pZTgwMTpTaGlwcGluZ01hcmtzPjwvaWU4MDE6UGFja2FnZT48aWU4MDE6UGFja2FnZT48aWU4MDE6S2luZE9mUGFja2FnZXM+Qkg8L2llODAxOktpbmRPZlBhY2thZ2VzPjxpZTgwMTpOdW1iZXJPZlBhY2thZ2VzPjI8L2llODAxOk51bWJlck9mUGFja2FnZXM+PGllODAxOlNoaXBwaW5nTWFya3M+U2hpcHBpbmcgY29tbWVudCAyPC9pZTgwMTpTaGlwcGluZ01hcmtzPjwvaWU4MDE6UGFja2FnZT48L2llODAxOkJvZHlFYWRFc2FkPjxpZTgwMTpUcmFuc3BvcnREZXRhaWxzPjxpZTgwMTpUcmFuc3BvcnRVbml0Q29kZT4xPC9pZTgwMTpUcmFuc3BvcnRVbml0Q29kZT48aWU4MDE6SWRlbnRpdHlPZlRyYW5zcG9ydFVuaXRzPlRyYW5zZm9ybWVycyByb2JvdHMgaW4gZGlzZ3Vpc2U8L2llODAxOklkZW50aXR5T2ZUcmFuc3BvcnRVbml0cz48L2llODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydFVuaXRDb2RlPjI8L2llODAxOlRyYW5zcG9ydFVuaXRDb2RlPjxpZTgwMTpJZGVudGl0eU9mVHJhbnNwb3J0VW5pdHM+TUFDSElORVM8L2llODAxOklkZW50aXR5T2ZUcmFuc3BvcnRVbml0cz48L2llODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydFVuaXRDb2RlPjM8L2llODAxOlRyYW5zcG9ydFVuaXRDb2RlPjxpZTgwMTpJZGVudGl0eU9mVHJhbnNwb3J0VW5pdHM+TU9SRSBNQUNISU5FUzwvaWU4MDE6SWRlbnRpdHlPZlRyYW5zcG9ydFVuaXRzPjwvaWU4MDE6VHJhbnNwb3J0RGV0YWlscz48L2llODAxOkVBREVTQURDb250YWluZXI+PC9pZTgwMTpCb2R5PjwvaWU4MDE6SUU4MDE+"
      val transformedEncodedMessage = "PGllODAxOklFODAxIHhtbG5zPSJodHRwOi8vd3d3LmdvdnRhbGsuZ292LnVrL3RheGF0aW9uL0ludGVybmF0aW9uYWxUcmFkZS9FeGNpc2UvTW92ZW1lbnRGb3JUcmFkZXJEYXRhLzMiIHhtbG5zOmRvYz0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpkb2M6VjMuMjMiIHhtbG5zOmVtY3M9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6RU1DUzpWMy4yMyIgeG1sbnM6ZXVjPSJodHRwOi8vd3d3LmdvdnRhbGsuZ292LnVrL3RheGF0aW9uL0ludGVybmF0aW9uYWxUcmFkZS9FeGNpc2UvRW1jc1VrQ29kZXMvMyIgeG1sbnM6aWUwPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODgwOlYzLjIzIiB4bWxuczppZTE9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MjU6VjMuMjMiIHhtbG5zOmllMj0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTcxNzpWMy4yMyIgeG1sbnM6aWUzPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODE1OlYzLjIzIiB4bWxuczppZT0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTkzNDpWMy4yMyIgeG1sbnM6aWU3MDR1az0iaHR0cDovL3d3dy5nb3Z0YWxrLmdvdi51ay90YXhhdGlvbi9JbnRlcm5hdGlvbmFsVHJhZGUvRXhjaXNlL2llNzA0dWsvMyIgeG1sbnM6aWU4MDE9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MDE6VjMuMjMiIHhtbG5zOmllODAyPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODAyOlYzLjIzIiB4bWxuczppZTgwMz0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTgwMzpWMy4yMyIgeG1sbnM6aWU4MDc9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MDc6VjMuMjMiIHhtbG5zOmllODEwPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODEwOlYzLjIzIiB4bWxuczppZTgxMz0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTgxMzpWMy4yMyIgeG1sbnM6aWU4MTg9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4MTg6VjMuMjMiIHhtbG5zOmllODE5PSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODE5OlYzLjIzIiB4bWxuczppZTgyOT0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTgyOTpWMy4yMyIgeG1sbnM6aWU4Mzc9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4Mzc6VjMuMjMiIHhtbG5zOmllODM5PSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODM5OlYzLjIzIiB4bWxuczppZTg0MD0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTg0MDpWMy4yMyIgeG1sbnM6aWU4NzE9InVybjpwdWJsaWNpZDotOkVDOkRHVEFYVUQ6RU1DUzpQSEFTRTQ6SUU4NzE6VjMuMjMiIHhtbG5zOmllODgxPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OklFODgxOlYzLjIzIiB4bWxuczppZTkwNT0idXJuOnB1YmxpY2lkOi06RUM6REdUQVhVRDpFTUNTOlBIQVNFNDpJRTkwNTpWMy4yMyIgeG1sbnM6dGNsPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OlRDTDpWMy4yMyIgeG1sbnM6dG1zPSJ1cm46cHVibGljaWQ6LTpFQzpER1RBWFVEOkVNQ1M6UEhBU0U0OlRNUzpWMy4yMyIgeG1sbnM6dG5zND0iaHR0cDovL3d3dy5nb3Z0YWxrLmdvdi51ay90YXhhdGlvbi9JbnRlcm5hdGlvbmFsVHJhZGUvQ29tbW9uL0NvbnRyb2xEb2N1bWVudCIgeG1sbnM6dG5zNT0iaHR0cDovL3d3dy5nb3Z0YWxrLmdvdi51ay90YXhhdGlvbi9JbnRlcm5hdGlvbmFsVHJhZGUvRXhjaXNlL01vdmVtZW50Rm9yVHJhZGVyRGF0YS8zIiB4bWxuczp0bnM9Imh0dHA6Ly93d3cuZ292dGFsay5nb3YudWsvdGF4YXRpb24vSW50ZXJuYXRpb25hbFRyYWRlL0V4Y2lzZS9OZXdNZXNzYWdlc0RhdGEvMyIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIj48aWU4MDE6SGVhZGVyPjx0bXM6TWVzc2FnZVNlbmRlcj5OREVBLlhJPC90bXM6TWVzc2FnZVNlbmRlcj48dG1zOk1lc3NhZ2VSZWNpcGllbnQ+TkRFQS5BVDwvdG1zOk1lc3NhZ2VSZWNpcGllbnQ+PHRtczpEYXRlT2ZQcmVwYXJhdGlvbj4yMDIzLTA2LTIyPC90bXM6RGF0ZU9mUHJlcGFyYXRpb24+PHRtczpUaW1lT2ZQcmVwYXJhdGlvbj4xMjozNzowOC43NTU8L3RtczpUaW1lT2ZQcmVwYXJhdGlvbj48dG1zOk1lc3NhZ2VJZGVudGlmaWVyPlhJMDAwMDAzPC90bXM6TWVzc2FnZUlkZW50aWZpZXI+PHRtczpDb3JyZWxhdGlvbklkZW50aWZpZXI+UE9SVEFMNmRlMWI4MjI1NjJjNDNmYjkyMjBkMjM2ZTQ4N2M5MjA8L3RtczpDb3JyZWxhdGlvbklkZW50aWZpZXI+PC9pZTgwMTpIZWFkZXI+PGllODAxOkJvZHk+PGllODAxOkVBREVTQURDb250YWluZXI+PGllODAxOkNvbnNpZ25lZVRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpUcmFkZXJpZD5HQldLUU9aODBWTFlSPC9pZTgwMTpUcmFkZXJpZD48aWU4MDE6VHJhZGVyTmFtZT5BRk9SIEtBTEUgTFREPC9pZTgwMTpUcmFkZXJOYW1lPjxpZTgwMTpTdHJlZXROYW1lPlRoZSBTdHJlZXQ8L2llODAxOlN0cmVldE5hbWU+PGllODAxOlBvc3Rjb2RlPkFUMTIzPC9pZTgwMTpQb3N0Y29kZT48aWU4MDE6Q2l0eT5UaGUgQ2l0eTwvaWU4MDE6Q2l0eT48L2llODAxOkNvbnNpZ25lZVRyYWRlcj48aWU4MDE6RXhjaXNlTW92ZW1lbnQ+PGllODAxOkFkbWluaXN0cmF0aXZlUmVmZXJlbmNlQ29kZT4yM1hJMDAwMDAwMDAwMDAwMDAwMjE8L2llODAxOkFkbWluaXN0cmF0aXZlUmVmZXJlbmNlQ29kZT48aWU4MDE6RGF0ZUFuZFRpbWVPZlZhbGlkYXRpb25PZkVhZEVzYWQ+MjAyMy0wNi0yMlQxMTozNzoxMC4zNDU3MzkzOTY8L2llODAxOkRhdGVBbmRUaW1lT2ZWYWxpZGF0aW9uT2ZFYWRFc2FkPjwvaWU4MDE6RXhjaXNlTW92ZW1lbnQ+PGllODAxOkNvbnNpZ25vclRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpUcmFkZXJFeGNpc2VOdW1iZXI+R0JXS1FPWjk5VkxZUjwvaWU4MDE6VHJhZGVyRXhjaXNlTnVtYmVyPjxpZTgwMTpUcmFkZXJOYW1lPkNsYXJreXMgRWFnbGVzPC9pZTgwMTpUcmFkZXJOYW1lPjxpZTgwMTpTdHJlZXROYW1lPkhhcHB5IFN0cmVldDwvaWU4MDE6U3RyZWV0TmFtZT48aWU4MDE6UG9zdGNvZGU+QlQxIDFCRzwvaWU4MDE6UG9zdGNvZGU+PGllODAxOkNpdHk+VGhlIENpdHk8L2llODAxOkNpdHk+PC9pZTgwMTpDb25zaWdub3JUcmFkZXI+PGllODAxOlBsYWNlT2ZEaXNwYXRjaFRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpSZWZlcmVuY2VPZlRheFdhcmVob3VzZT5YSTAwMDAwNDY3MDE0PC9pZTgwMTpSZWZlcmVuY2VPZlRheFdhcmVob3VzZT48L2llODAxOlBsYWNlT2ZEaXNwYXRjaFRyYWRlcj48aWU4MDE6RGVsaXZlcnlQbGFjZVRyYWRlciBsYW5ndWFnZT0iZW4iPjxpZTgwMTpUcmFkZXJpZD5HQjAwMDAwNjAyMDc4PC9pZTgwMTpUcmFkZXJpZD48aWU4MDE6VHJhZGVyTmFtZT5NRVRFU1QgQk9ORCBTVFRTVEdFPC9pZTgwMTpUcmFkZXJOYW1lPjxpZTgwMTpTdHJlZXROYW1lPldISVRFVEVTVCBST0FEIE1FVEVTVCBDSVRZIEVTVEFURTwvaWU4MDE6U3RyZWV0TmFtZT48aWU4MDE6UG9zdGNvZGU+Qk4yIDRLWDwvaWU4MDE6UG9zdGNvZGU+PGllODAxOkNpdHk+U1RURVNULEtFTlQ8L2llODAxOkNpdHk+PC9pZTgwMTpEZWxpdmVyeVBsYWNlVHJhZGVyPjxpZTgwMTpDb21wZXRlbnRBdXRob3JpdHlEaXNwYXRjaE9mZmljZT48aWU4MDE6UmVmZXJlbmNlTnVtYmVyPkdCMDA0MDk4PC9pZTgwMTpSZWZlcmVuY2VOdW1iZXI+PC9pZTgwMTpDb21wZXRlbnRBdXRob3JpdHlEaXNwYXRjaE9mZmljZT48aWU4MDE6RWFkRXNhZD48aWU4MDE6TG9jYWxSZWZlcmVuY2VOdW1iZXI+bHJuaWU4MTU0OTY4NTcxPC9pZTgwMTpMb2NhbFJlZmVyZW5jZU51bWJlcj48aWU4MDE6SW52b2ljZU51bWJlcj5JTlZPSUNFMDAxPC9pZTgwMTpJbnZvaWNlTnVtYmVyPjxpZTgwMTpJbnZvaWNlRGF0ZT4yMDE4LTA0LTA0PC9pZTgwMTpJbnZvaWNlRGF0ZT48aWU4MDE6T3JpZ2luVHlwZUNvZGU+MTwvaWU4MDE6T3JpZ2luVHlwZUNvZGU+PGllODAxOkRhdGVPZkRpc3BhdGNoPjIwMjEtMTItMDI8L2llODAxOkRhdGVPZkRpc3BhdGNoPjxpZTgwMTpUaW1lT2ZEaXNwYXRjaD4yMjozNzowMDwvaWU4MDE6VGltZU9mRGlzcGF0Y2g+PC9pZTgwMTpFYWRFc2FkPjxpZTgwMTpIZWFkZXJFYWRFc2FkPjxpZTgwMTpTZXF1ZW5jZU51bWJlcj4xPC9pZTgwMTpTZXF1ZW5jZU51bWJlcj48aWU4MDE6RGF0ZUFuZFRpbWVPZlVwZGF0ZVZhbGlkYXRpb24+MjAyMy0wNi0yMlQxMTozNzoxMC4zNDU4MDEwMjk8L2llODAxOkRhdGVBbmRUaW1lT2ZVcGRhdGVWYWxpZGF0aW9uPjxpZTgwMTpEZXN0aW5hdGlvblR5cGVDb2RlPjE8L2llODAxOkRlc3RpbmF0aW9uVHlwZUNvZGU+PGllODAxOkpvdXJuZXlUaW1lPkQwMTwvaWU4MDE6Sm91cm5leVRpbWU+PGllODAxOlRyYW5zcG9ydEFycmFuZ2VtZW50PjE8L2llODAxOlRyYW5zcG9ydEFycmFuZ2VtZW50PjwvaWU4MDE6SGVhZGVyRWFkRXNhZD48aWU4MDE6VHJhbnNwb3J0TW9kZT48aWU4MDE6VHJhbnNwb3J0TW9kZUNvZGU+MTwvaWU4MDE6VHJhbnNwb3J0TW9kZUNvZGU+PC9pZTgwMTpUcmFuc3BvcnRNb2RlPjxpZTgwMTpNb3ZlbWVudEd1YXJhbnRlZT48aWU4MDE6R3VhcmFudG9yVHlwZUNvZGU+MTwvaWU4MDE6R3VhcmFudG9yVHlwZUNvZGU+PC9pZTgwMTpNb3ZlbWVudEd1YXJhbnRlZT48aWU4MDE6Qm9keUVhZEVzYWQ+PGllODAxOkJvZHlSZWNvcmRVbmlxdWVSZWZlcmVuY2U+MTwvaWU4MDE6Qm9keVJlY29yZFVuaXF1ZVJlZmVyZW5jZT48aWU4MDE6RXhjaXNlUHJvZHVjdENvZGU+RTQxMDwvaWU4MDE6RXhjaXNlUHJvZHVjdENvZGU+PGllODAxOkNuQ29kZT4yNzEwMTIzMTwvaWU4MDE6Q25Db2RlPjxpZTgwMTpRdWFudGl0eT4xMDAuMDAwPC9pZTgwMTpRdWFudGl0eT48aWU4MDE6R3Jvc3NNYXNzPjEwMC4wMDwvaWU4MDE6R3Jvc3NNYXNzPjxpZTgwMTpOZXRNYXNzPjkwLjAwPC9pZTgwMTpOZXRNYXNzPjxpZTgwMTpEZW5zaXR5PjEwLjAwPC9pZTgwMTpEZW5zaXR5PjxpZTgwMTpQYWNrYWdlPjxpZTgwMTpLaW5kT2ZQYWNrYWdlcz5CSDwvaWU4MDE6S2luZE9mUGFja2FnZXM+PGllODAxOk51bWJlck9mUGFja2FnZXM+MjwvaWU4MDE6TnVtYmVyT2ZQYWNrYWdlcz48aWU4MDE6U2hpcHBpbmdNYXJrcz5TaGlwcGluZyBjb21tZW50PC9pZTgwMTpTaGlwcGluZ01hcmtzPjwvaWU4MDE6UGFja2FnZT48aWU4MDE6UGFja2FnZT48aWU4MDE6S2luZE9mUGFja2FnZXM+Qkg8L2llODAxOktpbmRPZlBhY2thZ2VzPjxpZTgwMTpOdW1iZXJPZlBhY2thZ2VzPjI8L2llODAxOk51bWJlck9mUGFja2FnZXM+PGllODAxOlNoaXBwaW5nTWFya3M+U2hpcHBpbmcgY29tbWVudCAyPC9pZTgwMTpTaGlwcGluZ01hcmtzPjwvaWU4MDE6UGFja2FnZT48L2llODAxOkJvZHlFYWRFc2FkPjxpZTgwMTpUcmFuc3BvcnREZXRhaWxzPjxpZTgwMTpUcmFuc3BvcnRVbml0Q29kZT4xPC9pZTgwMTpUcmFuc3BvcnRVbml0Q29kZT48aWU4MDE6SWRlbnRpdHlPZlRyYW5zcG9ydFVuaXRzPlRyYW5zZm9ybWVycyByb2JvdHMgaW4gZGlzZ3Vpc2U8L2llODAxOklkZW50aXR5T2ZUcmFuc3BvcnRVbml0cz48L2llODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydFVuaXRDb2RlPjI8L2llODAxOlRyYW5zcG9ydFVuaXRDb2RlPjxpZTgwMTpJZGVudGl0eU9mVHJhbnNwb3J0VW5pdHM+TUFDSElORVM8L2llODAxOklkZW50aXR5T2ZUcmFuc3BvcnRVbml0cz48L2llODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydERldGFpbHM+PGllODAxOlRyYW5zcG9ydFVuaXRDb2RlPjM8L2llODAxOlRyYW5zcG9ydFVuaXRDb2RlPjxpZTgwMTpJZGVudGl0eU9mVHJhbnNwb3J0VW5pdHM+TU9SRSBNQUNISU5FUzwvaWU4MDE6SWRlbnRpdHlPZlRyYW5zcG9ydFVuaXRzPjwvaWU4MDE6VHJhbnNwb3J0RGV0YWlscz48L2llODAxOkVBREVTQURDb250YWluZXI+PC9pZTgwMTpCb2R5PjwvaWU4MDE6SUU4MDE+"
      val result = await(sut.transform(messageType, encodedMessage))

      result mustBe Right(transformedEncodedMessage)

    }
  }

}